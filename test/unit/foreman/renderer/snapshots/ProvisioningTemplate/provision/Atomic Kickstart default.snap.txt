

lang en_US.UTF-8
keyboard us
timezone --utc UTC


network --bootproto dhcp --hostname snapshothost --device=00-f0-54-1a-7e-e0
# Partition table should create /boot and a volume atomicos
zerombr\nclearpart --all    --initlabel\npart /boot --fstype ext3 --size=100 --asprimary\npart /     --f   stype ext3 --size=1024 --grow\npart swap  --recommended

bootloader --timeout=3
text

ostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host-ostree --url=file:///install/ostree --ref=rhel-atomic-host/7/x86_64/standard
services --disabled cloud-init,cloud-config,cloud-final,cloud-init-local
rootpw --iscrypted xybxa6JUkz63w

reboot


%pre --log=/tmp/install.pre.custom.log
# Custom pre snippet generated by "Atomic Kickstart default custom pre"

%end

# copy %pre log files into chroot
%post --nochroot
cp -vf /tmp/*pre*log /tmp/sysimage/root/
%end

# The remote_execution_ssh_user does not exist and remote_execution_create_user is not
# set to true. No SSH key will be installed.


%post








rm -f /etc/ostree/remotes.d/*.conf


touch /tmp/foreman_built
%end

%post --log=/root/install.post.custom.log
# Custom post snippet generated by "Atomic Kickstart default custom post"

%end


%post --erroronfail
if test -f /tmp/foreman_built; then
  echo "calling home: build is done!"
  if [ -x /usr/bin/curl ]; then
    /usr/bin/curl -o /dev/null --noproxy \* -H 'Content-Type: text/plain' --data @/root/install.post.log --silent 'http://foreman.some.host.fqdn/unattended/built'
  elif [ -x /usr/bin/wget ]; then
    /usr/bin/wget -q -O /dev/null --no-proxy --method POST --header 'Content-Type: text/plain' --body-file=/root/install.post.log 'http://foreman.some.host.fqdn/unattended/built'
  else
    wget -q -O /dev/null --header 'Content-Type: text/plain' 'http://foreman.some.host.fqdn/unattended/built'
  fi
else
  echo "calling home: build failed!"
  if [ -x /usr/bin/curl ]; then
    /usr/bin/curl -o /dev/null --noproxy \* -H 'Content-Type: text/plain' --data @/root/install.post.log --silent 'http://foreman.some.host.fqdn/unattended/failed'
  elif [ -x /usr/bin/wget ]; then
    /usr/bin/wget -q -O /dev/null --no-proxy --method POST --header 'Content-Type: text/plain' --body-file=/root/install.post.log 'http://foreman.some.host.fqdn/unattended/failed'
  else
    wget -q -O /dev/null --header 'Content-Type: text/plain' 'http://foreman.some.host.fqdn/unattended/failed'
  fi
fi

sync
%end
